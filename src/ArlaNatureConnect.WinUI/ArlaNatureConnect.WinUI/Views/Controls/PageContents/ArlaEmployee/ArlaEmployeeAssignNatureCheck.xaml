<UserControl
    x:Class="ArlaNatureConnect.WinUI.Views.Controls.PageContents.ArlaEmployee.ArlaEmployeeAssignNatureCheck"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:ArlaNatureConnect.WinUI.Converters"
    xmlns:pages="using:ArlaNatureConnect.WinUI.ViewModels.Pages"
    xmlns:local="using:ArlaNatureConnect.WinUI.Views.Controls.PageContents.ArlaEmployee"
    d:DataContext="{d:DesignInstance Type=pages:ArlaEmployeeAssignNatureCheckViewModel}"
    mc:Ignorable="d"
    Background="{StaticResource AppBackgroundBrush}">

    <!-- Layout Section: Two-column workspace -->
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="1.2*" />
        </Grid.ColumnDefinitions>

        <!-- Content Section: Farm list and filters -->
        <Border Grid.Column="0"
                Margin="16"
                Background="White"
                CornerRadius="12"
                Padding="16"
                BorderBrush="{StaticResource ArlaPrimaryMutedBrush}"
                BorderThickness="1">
            <StackPanel Spacing="12">
                <TextBlock Text="Gård listen"
                           Style="{StaticResource ArlaSectionHeader}" />

                <!-- Bindings Section: Search box -->
                <StackPanel Orientation="Vertical" Spacing="4">
                    <TextBlock Text="Søg gårde"
                               Style="{StaticResource ArlaBodyText}"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource ArlaPrimaryDarkBrush}" />
                    <TextBox PlaceholderText="Søg gårde"
                             Text="{Binding FarmSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource ArlaTextBox}" />
                </StackPanel>

                <!-- Buttons Section: Status filter buttons -->
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <Button Content="Alle"
                            Style="{StaticResource ArlaFilterPrimaryButton}"
                            Command="{Binding ApplyStatusFilterCommand}"
                            CommandParameter="All" />
                    <Button Content="Ikke tilføjet"
                            Style="{StaticResource ArlaFilterSecondaryButton}"
                            Command="{Binding ApplyStatusFilterCommand}"
                            CommandParameter="Unassigned" />
                    <Button Content="Tilføjet"
                            Style="{StaticResource ArlaFilterSecondaryButton}"
                            Command="{Binding ApplyStatusFilterCommand}"
                            CommandParameter="Assigned" />
                </StackPanel>

                <!-- Content Section: Farm items -->
                <ListView ItemsSource="{Binding FilteredFarms}"
                          SelectedItem="{Binding SelectedFarm, Mode=TwoWay}"
                          Height="520">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Border Margin="0,4"
                                    Padding="12"
                                    Background="{StaticResource ArlaSurfaceBrush}"
                                    BorderBrush="{StaticResource ArlaPrimaryBrush}"
                                    BorderThickness="2"
                                    CornerRadius="8">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal"
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Center"
                                                Spacing="8">
                                        <TextBlock Text="{Binding FarmName}"
                                                   FontWeight="SemiBold"
                                                   Style="{StaticResource ArlaBodyText}" />
                                        <Border Style="{StaticResource StatusPillStyle}">
                                            <TextBlock Text="{Binding StatusLabel}"
                                                       Foreground="{StaticResource ArlaPrimaryDarkBrush}"
                                                       FontSize="12" />
                                        </Border>
                                        <Border Style="{StaticResource StatusPillStyle}"
                                                Visibility="{Binding HasPriority, Converter={StaticResource BoolToVis}}">
                                            <TextBlock Text="{Binding PriorityDisplay}"
                                                       Foreground="{StaticResource ArlaErrorBrush}"
                                                       FontSize="12" />
                                        </Border>
                                    </StackPanel>
                                    <TextBlock Text="{Binding Cvr}"
                                               Style="{StaticResource ArlaCaptionText}" />
                                    <TextBlock Text="{Binding AddressLine}"
                                               Style="{StaticResource ArlaCaptionText}" />
                                    <TextBlock Text="{Binding OwnerName}"
                                               Style="{StaticResource ArlaCaptionText}" />
                                    <TextBlock Text="{Binding ConsultantDisplay}"
                                               Style="{StaticResource ArlaCaptionText}"
                                               Foreground="{StaticResource ArlaPrimaryDarkBrush}" />
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <!-- Buttons Section: CRUD shortcuts moved under list -->
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <Button Content="Tilføj ny gård"
                            Style="{StaticResource ArlaPositiveButton}"
                            Command="{Binding ShowFarmEditorCommand}"
                            CommandParameter="Add" />
                    <Button Content="Rediger"
                            Style="{StaticResource ArlaAccentButton}"
                            Command="{Binding ShowFarmEditorCommand}"
                            CommandParameter="Edit"
                            IsEnabled="{Binding IsFarmSelected}" />
                    <Button Content="Slet"
                            Style="{StaticResource ArlaDangerButton}"
                            Command="{Binding DeleteFarmCommand}"
                            IsEnabled="{Binding IsFarmSelected}" />
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Content Section: Assignment form -->
        <Border Grid.Column="1"
                Margin="16"
                Background="White"
                CornerRadius="12"
                Padding="16"
                BorderBrush="{StaticResource ArlaPrimaryMutedBrush}"
                BorderThickness="1">
            <StackPanel Spacing="12">
                <TextBlock Text="Tilføj Natur Check opgave"
                           Style="{StaticResource ArlaSectionHeader}" />

                <StackPanel>
                    <TextBlock Text="Gård detaljer"
                               Style="{StaticResource ArlaCaptionText}" />
                    <TextBlock Text="{Binding SelectedFarm.FarmName, TargetNullValue='Vælg en gård'}"
                               Style="{StaticResource ArlaBodyText}"
                               FontWeight="SemiBold" />
                    <TextBlock Text="{Binding SelectedFarm.AddressLine}"
                               Style="{StaticResource ArlaCaptionText}" />
                    <TextBlock Text="{Binding SelectedFarm.OwnerName}"
                               Style="{StaticResource ArlaCaptionText}" />
                </StackPanel>

                <StackPanel Orientation="Vertical" Spacing="4">
                    <TextBlock Text="Vælg konsulent"
                               Style="{StaticResource ArlaBodyText}"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource ArlaPrimaryDarkBrush}" />
                    <ComboBox ItemsSource="{Binding Consultants}"
                              SelectedItem="{Binding SelectedConsultant, Mode=TwoWay}"
                              PlaceholderText="Vælg konsulent"
                              Style="{StaticResource ArlaComboBox}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="{Binding FirstName}" />
                                    <TextBlock Text="{Binding LastName}" />
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </StackPanel>

                <StackPanel Orientation="Vertical" Spacing="4">
                    <TextBlock Text="Prioritet"
                               Style="{StaticResource ArlaBodyText}"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource ArlaPrimaryDarkBrush}" />
                    <ComboBox ItemsSource="{Binding PriorityOptions}"
                              SelectedItem="{Binding SelectedPriority, Mode=TwoWay}"
                              PlaceholderText="Vælg prioritet"
                              Style="{StaticResource ArlaComboBox}" />
                </StackPanel>

                <StackPanel Orientation="Vertical" Spacing="4">
                    <TextBlock Text="Kommentar"
                               Style="{StaticResource ArlaBodyText}"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource ArlaPrimaryDarkBrush}" />
                    <TextBox Text="{Binding AssignmentNotes, Mode=TwoWay}"
                             AcceptsReturn="True"
                             Height="140"
                             TextWrapping="Wrap"
                             Style="{StaticResource ArlaTextBox}" />
                </StackPanel>

                <Button Content="{Binding AssignCaseButtonText}"
                        Style="{StaticResource ArlaPrimaryActionButton}"
                        Command="{Binding AssignNatureCheckCaseCommand}"
                        IsEnabled="{Binding IsFarmSelected}" />
            </StackPanel>
        </Border>

        <!-- Content Section: Farm editor overlay -->
        <local:FarmEditorDialog Grid.ColumnSpan="2" />
    </Grid>
</UserControl>

