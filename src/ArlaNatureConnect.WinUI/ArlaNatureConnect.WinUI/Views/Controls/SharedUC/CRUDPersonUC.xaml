<?xml version="1.0" encoding="utf-8"?>
<UserControl
  x:Class="ArlaNatureConnect.WinUI.Views.Controls.SharedUC.CRUDPersonUC"
  x:Name="Root"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:local="using:ArlaNatureConnect.WinUI.Views.Controls.SharedUC"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
  xmlns:shareduc="using:ArlaNatureConnect.WinUI.ViewModels.Controls.SharedUC" 
  xmlns:conv="using:ArlaNatureConnect.WinUI.Converters"
  d:DataContext="{d:DesignInstance Type=shareduc:CRUDPersonUCViewModel}"
  mc:Ignorable="d">
  <UserControl.Resources>
    <conv:AlternationToBrushConverter x:Key="AlternationToBrushConverter" />
  </UserControl.Resources>

  <Grid Padding="8">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <!-- Header row (fixed) -->
      <RowDefinition Height="*"/>
      <!-- ListView row fills remaining space -->
    </Grid.RowDefinitions>

    <StackPanel Orientation="Vertical" Grid.Row="0" Spacing="8">
      <StackPanel Orientation="Horizontal" Spacing="8">
        <TextBlock Text="{Binding LabelFirstName, Mode=OneTime}" VerticalAlignment="Center" Width="120" />
        <TextBox Text="{Binding FirstName, Mode=TwoWay}" Width="300" />
      </StackPanel>

      <StackPanel Orientation="Horizontal" Spacing="8">
        <TextBlock Text="{Binding LabelLastName, Mode=OneTime}" VerticalAlignment="Center" Width="120" />
        <TextBox Text="{Binding LastName, Mode=TwoWay}" Width="300" />
      </StackPanel>

      <StackPanel Orientation="Horizontal" Spacing="8">
        <TextBlock Text="{Binding LabelEmail, Mode=OneTime}" VerticalAlignment="Center" Width="120" />
        <TextBox Text="{Binding Email, Mode=TwoWay}" Width="300" />
      </StackPanel>

      <StackPanel Orientation="Horizontal" Spacing="8">
        <TextBlock Text="{Binding LabelIsActive, Mode=OneTime}" VerticalAlignment="Center" Width="120" />
        <ToggleSwitch IsOn="{Binding IsActive, Mode=TwoWay}" />
      </StackPanel>

      <!-- RoleId and AddressId are simple text fields here. Replace with ComboBox when collections are available. -->
      <StackPanel Orientation="Horizontal" Spacing="8">
        <TextBlock Text="{Binding LabelRole, Mode=OneTime}" VerticalAlignment="Center" Width="120" />
        <!-- Dropdown for selecting a Role. Binds to Roles collection and SelectedRole on the view-model. -->
        <ComboBox ItemsSource="{Binding Roles}"
                  SelectedItem="{Binding SelectedRole, Mode=TwoWay}"
                  DisplayMemberPath="Name"
                  Width="300" />
      </StackPanel>

      <StackPanel Orientation="Horizontal" Spacing="8">
        <TextBlock Text="{Binding LabelAddress, Mode=OneTime}" VerticalAlignment="Center" Width="120" />
        <TextBlock Text="{Binding AddressDisplay, Mode=OneWay}" Width="300" />
      </StackPanel>
    </StackPanel>


    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8" Margin="0,12,0,0" Grid.Row="5">
      <Button Content="Add" Command="{Binding AddCommand}" />
      <Button Content="Save" Command="{Binding SaveCommand}" />
      <Button Content="Delete" Command="{Binding DeleteCommand}" />
      <Button Content="Cancel" Command="{Binding CancelCommand}" />
    </StackPanel>

    <!-- Fixed header row placed outside the ListView so it remains visible while scrolling -->
    <Grid Grid.Row="6" MaxWidth="900">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="100" />
        <ColumnDefinition Width="100" />
        <ColumnDefinition Width="200" />
        <ColumnDefinition Width="50" />
        <ColumnDefinition Width="100" />
        <ColumnDefinition Width="250" />
        <ColumnDefinition Width="100" />
      </Grid.ColumnDefinitions>
      <Button Grid.Column="0"
              Content="{Binding LabelFirstName, Mode=OneTime}"
              Width="100"
              FontWeight="SemiBold"
              Command="{Binding SortCommand}"
              CommandParameter="FirstName"
              Background="Transparent"
              BorderThickness="0" />
      <Button Grid.Column="1"
              Content="{Binding LabelLastName, Mode=OneTime}"
              Width="100"
              FontWeight="SemiBold"
              Command="{Binding SortCommand}"
              CommandParameter="LastName"
              Background="Transparent"
              BorderThickness="0" />
      <Button Grid.Column="2"
              Content="{Binding LabelEmail, Mode=OneTime}"
              Width="200"
              FontWeight="SemiBold"
              Command="{Binding SortCommand}"
              CommandParameter="Email"
              Background="Transparent"
              BorderThickness="0" />
      <Button Grid.Column="3"
              Content="{Binding LabelIsActive, Mode=OneTime}"
              Width="50"
              FontWeight="SemiBold"
              Command="{Binding SortCommand}"
              CommandParameter="IsActive"
              Background="Transparent"
              BorderThickness="0" />
      <Button Grid.Column="4" 
              Content="{Binding LabelRole, Mode=OneTime}"
              Width="100"
              FontWeight="SemiBold"
              Command="{Binding SortCommand}"
              CommandParameter="Role.Name"
              Background="Transparent"
              BorderThickness="0" />
      <Button Grid.Column="5" 
              Content="{Binding LabelAddress, Mode=OneTime}"
              Width="250"
              FontWeight="SemiBold"
              Command="{Binding SortCommand}"
              CommandParameter="Address.PostalCode"
              Background="Transparent"
              BorderThickness="0" />
      <Button Grid.Column="6" 
              Content="{Binding LabelFarms, Mode=OneTime}"
              Width="100"
              FontWeight="SemiBold"
              Command="{Binding SortCommand}"
              CommandParameter="Farms.Count"
              Background="Transparent"
              BorderThickness="0" />
    </Grid>

    <ListView Grid.Row="7"
              x:Name="PersonList"
              ItemsSource="{Binding Items, Mode=OneWay}"
              SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
              SelectionMode="Single"
              Margin="0,8,0,0"
              MaxHeight="300"
              MaxWidth="900">

      <ListView.ItemContainerStyle>
        <Style TargetType="ListViewItem">
          <Setter Property="Padding" Value="0" />
          <Setter Property="Margin" Value="0" />
          <Setter Property="BorderThickness" Value="0" />
          <Setter Property="HorizontalContentAlignment" Value="Stretch" />
          <Setter Property="VerticalContentAlignment" Value="Stretch" />
          <Setter Property="MinHeight" Value="0" />
        </Style>
      </ListView.ItemContainerStyle>

      <ListView.ItemTemplate>
        <DataTemplate>
          <!-- Each row is a bordered Grid to show cell separators like a table -->
          <Border BorderBrush="{StaticResource ArlaPrimaryDarkBrush}" BorderThickness="0,0,0,1" Background="{Binding DataContext.ItemCounter, ElementName=Root, Converter={StaticResource AlternationToBrushConverter}}">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="100" />
                <ColumnDefinition Width="100" />
                <ColumnDefinition Width="200" />
                <ColumnDefinition Width="50" />
                <ColumnDefinition Width="100" />
                <ColumnDefinition Width="250" />
                <ColumnDefinition Width="100" />
              </Grid.ColumnDefinitions>

              <Border Grid.Column="0" BorderBrush="{StaticResource ArlaPrimaryDarkBrush}" BorderThickness="1,0,0,0" Padding="4,0,0,0">
                <TextBlock Text="{Binding FirstName}" VerticalAlignment="Center" />
              </Border>

              <Border Grid.Column="1" BorderBrush="{StaticResource ArlaPrimaryDarkBrush}" BorderThickness="1,0,0,0" Padding="4,0,0,0">
                <TextBlock Text="{Binding LastName}" VerticalAlignment="Center" />
              </Border>

              <Border Grid.Column="2" BorderBrush="{StaticResource ArlaPrimaryDarkBrush}" BorderThickness="1,0,0,0" Padding="4,0,0,0">
                <TextBlock Text="{Binding Email}" VerticalAlignment="Center" />
              </Border>

              <Border Grid.Column="3" BorderBrush="{StaticResource ArlaPrimaryDarkBrush}" BorderThickness="1,0,0,0" Padding="4,0,0,0">
                <TextBlock Text="{Binding IsActive}" VerticalAlignment="Center" />
              </Border>

              <Border Grid.Column="4" BorderBrush="{StaticResource ArlaPrimaryDarkBrush}" BorderThickness="1,0,0,0" Padding="4,0,0,0">
                <TextBlock Text="{Binding Role.Name}" VerticalAlignment="Center" />
              </Border>

              <Border Grid.Column="5" BorderBrush="{StaticResource ArlaPrimaryDarkBrush}" BorderThickness="1,0,0,0" Padding="4,0,0,0">
                <StackPanel Orientation="Horizontal">
                  <TextBlock Text="{Binding Address.PostalCode}" />
                  <TextBlock Text=", " />
                  <TextBlock Text="{Binding Address.Street}" />
                  <StackPanel>

                    <Button Content="View" Command="{Binding DataContext.ViewAddressCommand, ElementName=Root}" CommandParameter="{Binding AddressId}" HorizontalAlignment="Right" VerticalAlignment="Center" Padding="4,0" Margin="0,0,4,0" />

                  </StackPanel>
                </StackPanel>
              </Border>

              <Border Grid.Column="6" BorderBrush="{StaticResource ArlaPrimaryDarkBrush}" BorderThickness="1,0,1,0" Padding="4,0,0,0">
                <TextBlock Text="{Binding Farms.Count}" VerticalAlignment="Center" />
              </Border>

            </Grid>
          </Border>
        </DataTemplate>
      </ListView.ItemTemplate>
    </ListView>
  </Grid>
</UserControl>
