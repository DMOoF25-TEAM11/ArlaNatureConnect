# UC002B.3 Domain Model

Domain Model for Update Nature Check Case Assignment use case. This builds upon UC002B.2 and adds update-specific relationships and concepts.

```mermaid
---
title: Use Case 002B.3 - Domain Model (Builds on UC002B.2)
---
classDiagram
    direction TB

    class Farm {
        Name
        CVR
    }

    class Person {
        FirstName
        LastName
        Email
        IsActive
    }

    class Address {
        Street
        City
        PostalCode
        Country
    }

    class Role {
        Name
    }

    class NatureCheckCase {
        Status
        Notes
        Priority
        CreatedAt
        AssignedAt
        RowVersion
    }

    class Notification {
        CaseId
        ConsultantId
        CreatedAt
        IsRead
    }

    %% Relationships from UC002B.1 and UC002B.2
    Farm "1" -- "0..*" NatureCheckCase : has
    Person "1" -- "0..*" NatureCheckCase : assignedTo
    Person "1" -- "0..*" NatureCheckCase : assignedBy
    Person "1" -- "1" Role : has
    Person "1" -- "0..1" Address : residesAt
    Farm "1" -- "1" Address : locatedAt
    Farm "1" -- "1" Person : ownedBy
    NatureCheckCase "1" -- "1" Notification : generates
    Person "1" -- "0..*" Notification : receives
    
    %% New relationships for UC002B.3 (Update)
    NatureCheckCase "1" -- "0..*" Notification : updates
```

**Domain Concepts (from UC002B.1 and UC002B.2):**
- **Farm** - A farm that can have Nature Check Cases assigned to it
- **Person** - A person in the system who can be a consultant, Arla employee, or farm owner
- **Address** - A physical address where a person resides or a farm is located
- **Role** - A role that defines a person's function in the system (Consultant, Employee, Farmer)
- **NatureCheckCase** - An assignment of a Nature Check task to a consultant for a specific farm
- **Notification** - A database notification created when a case is assigned to a consultant
- **Assignment** - The act of creating a Nature Check Case and linking it to a farm and consultant

**New Domain Concepts (UC002B.3):**
- **Case Update** - The process of modifying an existing active Nature Check Case
- **Reassignment** - Changing the consultant assigned to a case
- **Concurrency Control** - Using RowVersion to detect concurrent modifications

**Domain Relationships (from UC002B.1 and UC002B.2):**
- A Farm can have zero or more Nature Check Cases
- A Person (consultant) can be assigned to zero or more Nature Check Cases
- A Person (Arla employee) can assign zero or more Nature Check Cases
- A Person has exactly one Role
- A Person may have one Address (where they reside)
- A Farm has exactly one Address (where it is located)
- A Farm has exactly one Person as owner
- A Nature Check Case generates exactly one Notification when assigned
- A Person (consultant) can receive zero or more Notifications

**New Domain Relationships (UC002B.3):**
- When a case is updated, it may generate additional notifications (if consultant changed)
- A case can be updated multiple times, each update potentially creating new notifications

**Business Rules (from UC002B.1 and UC002B.2):**
- A Nature Check Case is always linked to one Farm
- A Nature Check Case is always assigned to one Person (consultant)
- A Nature Check Case is always assigned by one Person (Arla employee)
- A Farm must have an owner (Person)
- A Farm must have an address (Address)
- Priority is an optional attribute that indicates the urgency of a Nature Check Case
- Status indicates the current state of a Nature Check Case (Assigned, InProgress, Completed, etc.)
- Notes provide additional information about a Nature Check Case
- When a new Nature Check Case is created, it must have status "Assigned"
- A farm cannot have multiple active cases (status "Assigned" or "InProgress") at the same time
- The consultant must have the "Consultant" role to be assigned a case
- Priority must be stored in English format ("Low", "Medium", "High", "Urgent") even though UI displays Danish
- When a case is assigned, both CreatedAt and AssignedAt are set to the current timestamp
- A notification is automatically created when a case is assigned to a consultant

**New Business Rules (UC002B.3):**
- Only active cases (status "Assigned" or "InProgress") can be updated
- When a case is updated, the AssignedAt timestamp is updated to reflect the modification
- Optimistic concurrency control (RowVersion) is used to detect concurrent modifications
- If a concurrent modification is detected, the update is rejected and the user must reload
- When consultant is changed, a new notification is created for the new consultant
- The old consultant's notification may be marked as read or removed when consultant changes
- Priority conversion (Danish to English) is performed during update operations
- All fields (consultant, priority, notes) can be updated independently

**Update-Specific Concepts:**
- **Case Modification** - The process of updating an existing Nature Check Case
- **Concurrent Modification Detection** - Using RowVersion to detect if another user modified the case
- **Notification Management** - Creating new notifications and managing old ones when consultant changes
- **Timestamp Update** - Updating AssignedAt to reflect when the case was last modified


