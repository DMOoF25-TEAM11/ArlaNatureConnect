# UC002B.3-SSD – Update Nature Check Case Assignment

System Sequence Diagram showing the interaction between the Arla Employee actor and the System, following Larmann's UML conventions.

```mermaid
sequenceDiagram
    title UC002B.3 – SSD: Update Nature Check Case Assignment

    actor ArlaEmployee as Arla Employee
    participant System as System

    ArlaEmployee ->> System: Select farm with active case
    System -->> ArlaEmployee: Display farm details and form auto-populated with existing assignment data
    
    ArlaEmployee ->> System: Modify consultant, priority, notes, click "Opdater natur Check opgave"
    System -->> System: Validate farm, consultant role, priority format, business rules
    System -->> System: Check RowVersion for concurrent modifications
    
    alt Validation succeeds and no concurrent modification
        System -->> System: Update existing Nature Check Case
        System -->> System: Store priority in English format
        System -->> System: Update AssignedAt timestamp
        
        alt Consultant changed
            System -->> System: Create notification for new consultant
            System -->> System: Mark old consultant's notification as read
        end
        
        System -->> System: Update farm assignment status
        System -->> ArlaEmployee: Display success message "Natur Check opgave er opdateret for [FarmName]"
    else Validation fails
        alt No active case exists
            System -->> ArlaEmployee: Display error "Gården har ingen aktiv opgave"
        else Consultant does not have Consultant role
            System -->> ArlaEmployee: Display error "Den valgte person har ikke konsulent-rollen"
        else Invalid priority
            System -->> ArlaEmployee: Display error "Ugyldig prioritet"
        end
    else Concurrent modification detected
        System -->> ArlaEmployee: Display error "Opgaven er blevet ændret af en anden bruger. Genindlæs og prøv igen"
    end
```

**Notes:**
- The system validates all inputs and checks for concurrent modifications using RowVersion.
- Priority is converted from Danish (UI) to English (database) during the update process.
- If consultant changed, a new notification is created and the old one is managed.
- The assignment timestamp is updated to reflect when the case was last modified.


