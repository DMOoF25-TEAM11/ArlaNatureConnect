## UC002B.3 – Design Class Diagram

This diagram shows the main components that collaborate when an Arla employee updates a Nature Check Case assignment. It builds upon UC002B.2 and adds update-specific classes. It follows Larmann's UML conventions.

```mermaid
classDiagram
    direction TB
    %% === DCD – UC002B.3: Update Nature Check Case (Builds on UC002B.2) ===

    %% === DOMAIN ENTITIES (from UC002B.1 and UC002B.2) ===
    namespace ArlaNatureConnect.Domain.Entities {
        class NatureCheckCase {
            +Guid Id
            +Guid FarmId
            +Guid ConsultantId
            +Guid AssignedByPersonId
            +NatureCheckCaseStatus Status
            +string? Notes
            +string? Priority
            +DateTimeOffset CreatedAt
            +DateTimeOffset? AssignedAt
            +byte[] RowVersion
            +Farm Farm
            +Person Consultant
            +Person AssignedByPerson
        }

        class Notification {
            +Guid Id
            +Guid CaseId
            +Guid ConsultantId
            +DateTimeOffset CreatedAt
            +bool IsRead
            +NatureCheckCase Case
            +Person Consultant
        }
    }

    %% === DTOs (Data Transfer Objects) - extends UC002B.2 ===
    namespace ArlaNatureConnect.Core.DTOs {
        class NatureCheckCaseAssignmentRequest {
            +Guid FarmId
            +Guid ConsultantId
            +Guid AssignedByPersonId
            +string? Notes
            +string? Priority
            +bool AllowDuplicateActiveCase
            +byte[]? RowVersion
        }
    }

    %% === SERVICES (Core Layer) - extends UC002B.2 ===
    namespace ArlaNatureConnect.Core.Services {
        class INatureCheckCaseService {
            <<interface>>
            +Task~NatureCheckCase~ UpdateCaseAsync(Guid, NatureCheckCaseAssignmentRequest, CancellationToken) Task
            +Task~NatureCheckCase?~ GetActiveCaseForFarmAsync(Guid, CancellationToken) Task
        }

        class NatureCheckCaseService {
            +Task~NatureCheckCase~ UpdateCaseAsync(Guid, NatureCheckCaseAssignmentRequest, CancellationToken) Task
            +Task~NatureCheckCase?~ GetActiveCaseForFarmAsync(Guid, CancellationToken) Task
            -string ConvertPriorityToEnglish(string?) string
            -void ValidateUpdateRequest(NatureCheckCaseAssignmentRequest, NatureCheckCase) void
            -bool CheckRowVersion(byte[]?, byte[]) bool
        }
    }

    %% === REPOSITORIES (Core Abstract Layer) - extends UC002B.2 ===
    namespace ArlaNatureConnect.Core.Abstract {
        class INatureCheckCaseRepository {
            <<interface>>
            +Task~NatureCheckCase?~ GetActiveCaseForFarmAsync(Guid, CancellationToken) Task
            +Task UpdateAsync(NatureCheckCase, CancellationToken) Task
        }

        class INotificationRepository {
            <<interface>>
            +Task MarkNotificationAsReadAsync(Guid, Guid, CancellationToken) Task
        }
    }

    %% === RELATIONER (Relationships) ===
    NatureCheckCaseService ..|> INatureCheckCaseService : implements
    INatureCheckCaseRepository --> NatureCheckCase : manages
    INotificationRepository --> Notification : manages
    NatureCheckCaseService --> INatureCheckCaseRepository : uses
    NatureCheckCaseService --> INotificationRepository : uses
    NatureCheckCase --> Notification : generates
```


