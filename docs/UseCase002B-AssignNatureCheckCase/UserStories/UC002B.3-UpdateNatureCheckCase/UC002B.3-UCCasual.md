# Casual Use Case – UC002B.3: Update Nature Check Case Assignment

**Use case:** UC002B.3 – Update Nature Check Case Assignment  
**Scope:** The prototype of the Arla Nature Connect system  
**Level:** User goal  
**Primary Actors:** Arla Employee (Admin / Sustainability Staff)  
**Secondary Actors:** Consultant (receives notification if consultant changed)

---

### **Stakeholders and Interests**

- **Arla employees** want to update case assignments to reassign consultants or adjust priority/notes.  
- **Consultants** want to receive notifications when cases are reassigned to them.

---

### **Preconditions**

- The Arla employee is authenticated (UC01).  
- The employee has viewed farms and consultants (UC002B.1).  
- The selected farm exists in the system.  
- The farm has an active Nature Check Case (status "Assigned" or "InProgress").  
- The selected person exists in the system and has the *Consultant* role (if consultant is being changed).

---

### **Postconditions**

- The existing active Nature Check Case is updated with new consultant, priority (stored in English), and notes.  
- The case assignment time is updated to reflect the modification.  
- If consultant changed, notifications are regenerated from updated case data when consultant views them (not stored in database).  
- The farm's assignment status remains "Tilføjet" (Assigned).  
- The Arla employee sees a success confirmation message: "Natur Check opgave er opdateret for [FarmName]."

---

### **Main Success Scenario**

1. The Arla employee has viewed the list of farms and consultants (from UC002B.1).  
2. The employee selects a farm that has an active case.  
3. The system presents the selected farm's summary information.  
4. The system auto-populates the form with existing assignment data:
   - Current consultant (converted to display format)
   - Current priority (converted from English to Danish for display)
   - Current notes
5. The system displays button text "Opdater natur Check opgave" (Update Nature Check task).  
6. The employee modifies consultant, priority, and/or notes as needed.  
7. The employee confirms the update by clicking "Opdater natur Check opgave".  
8. The system validates the farm, consultant role (if changed), priority format, and business rules.  
9. The system checks for concurrent modifications using RowVersion.  
10. The system updates the existing active Nature Check Case with:
    - New consultant (if changed)
    - New priority (stored in English format)
    - New notes (if changed)
    - Updated assignment timestamp (AssignedAt)
11. If consultant changed, notifications are regenerated from updated case data when consultant views them (not stored in database).
12. The system shows success message "Natur Check opgave er opdateret for [FarmName]."  
13. The system updates the farm list to reflect the changes.

---

### **Extensions (Alternatives)**

- **2a. Farm does not exist:**  
  The system displays an error and directs the employee to select a different farm.

- **3a. Farm has no active case:**  
  The system displays error: "Gården har ingen aktiv opgave. Opret en ny opgave i stedet."  
  The employee can create a new case (UC002B.2).

- **6a. No changes made:**  
  The system detects that no fields were changed and may skip the update or show a message.

- **8a. Case was modified by another user (concurrency conflict):**  
  The system detects RowVersion mismatch and displays error: "Opgaven er blevet ændret af en anden bruger. Genindlæs og prøv igen."  
  The employee must reload the case and try again.

- **8b. Selected user is not a consultant:**  
  The system rejects the selection and asks for a valid consultant.

- **8c. Consultant does not exist or is inactive:**  
  The system prevents update and requests another consultant.

- **8d. Priority value is invalid:**  
  The system validates priority format (must be "Low", "Medium", "High", or "Urgent" in English) and rejects invalid values.

---

### **Special Requirements**

- Priority values are displayed in Danish ("Lav", "Normal", "Høj", "Haster") in the UI but stored in English ("Low", "Medium", "High", "Urgent") in the database.
- Optimistic concurrency control (RowVersion) is used to prevent conflicts when multiple users update the same case.
- When consultant is changed, notifications are regenerated from updated case data when consultant views them (not stored in database).
- The assignment timestamp (AssignedAt) is updated whenever the case is modified.
- All database operations use Entity Framework Core repositories (not stored procedures).


