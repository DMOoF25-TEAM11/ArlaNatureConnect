# Brief Use Case – UC002B.3: Update Nature Check Case Assignment

**Use Case ID:** UC002B.3  
**Use Case Name:** Update Nature Check Case Assignment  
**Scope:** System prototype (Arla Nature Connect)  
**Level:** User goal  
**Primary Actor:** Arla Employee (Admin / Sustainability Staff)

---

## Brief Description

The Arla employee updates an existing active Nature Check Case for a farm with new consultant, priority, and notes. The system validates the update and updates the case information, including creating a notification if the consultant changed.

---

## Preconditions

1. The Arla employee is authenticated in the system (UC01).
2. The selected farm exists in the system.
3. The farm has an active Nature Check Case (status "Assigned" or "InProgress").
4. The selected person exists in the system and has the Consultant role (if consultant is being changed).
5. If a priority is selected, it is a valid priority level.

---

## Postconditions

1. The existing active Nature Check Case is updated with the following properties:
   - The case is reassigned to the selected consultant (if changed)
   - The case priority is updated (if changed)
   - The case notes are updated (if changed)
   - The case assignment time is updated to reflect the modification
2. The farm's assignment status remains "Tilføjet" (Assigned).
3. If consultant changed, a new notification is created for the new consultant.
4. The Arla employee sees a success confirmation message: "Natur Check opgave er opdateret for [FarmName]."

---

## Main Success Scenario

1. The Arla employee has viewed farms and consultants (UC002B.1).
2. The employee selects a farm that has an active case.
3. The system auto-populates the form with existing assignment data (consultant, priority converted to Danish, notes).
4. The system displays button text "Opdater natur Check opgave" (Update Nature Check task).
5. The employee modifies consultant, priority, and/or notes as needed.
6. The employee clicks "Opdater natur Check opgave".
7. The system validates the farm, consultant role (if changed), priority format, and business rules.
8. The system updates the existing active Nature Check Case with new information.
9. The system stores priority in English format ("Low", "Medium", "High", "Urgent").
10. If consultant changed, the system creates a notification for the new consultant.
11. The system updates the assignment timestamp (AssignedAt).
12. The system displays success message: "Natur Check opgave er opdateret for [FarmName]."

---

## Extensions

### 2a. Farm does not exist:
The system displays an error and directs the employee to select a different farm.

### 3a. Farm has no active case:
The system displays an error and suggests creating a new case instead (UC002B.2).

### 5a. No consultant selected:
The system prompts the employee to choose a consultant before continuing.

### 5b. Selected user is not a consultant:
The system rejects the selection and asks for a valid consultant.

### 7a. Case was modified by another user (concurrency conflict):
The system detects RowVersion mismatch and displays error: "Opgaven er blevet ændret af en anden bruger. Genindlæs og prøv igen."

### 7b. Consultant does not exist or is inactive:
The system prevents update and requests another consultant.

### 7c. Priority value is invalid:
The system validates priority format and rejects invalid values.

---

## Technology Notes

- Priority values: UI displays Danish ("Lav", "Normal", "Høj", "Haster"), database stores English ("Low", "Medium", "High", "Urgent").
- Optimistic concurrency: RowVersion is used to detect concurrent modifications.
- The system uses stored procedures for all database operations (not Entity Framework).


