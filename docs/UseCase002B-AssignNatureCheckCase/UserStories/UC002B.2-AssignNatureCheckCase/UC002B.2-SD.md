## UC002B.2 – Sequence Diagram: Assign Nature Check Case to Consultant

This sequence diagram shows the detailed interaction flow when an Arla employee assigns a Nature Check Case to a consultant, following Larmann's UML conventions.

```mermaid
sequenceDiagram
    title UC002B.2 – Sequence Diagram: Assign Nature Check Case to Consultant

    actor ArlaEmployee as Arla Employee
    participant ViewModel as ArlaEmployeeAssignNatureCheckViewModel
    participant Request as NatureCheckCaseAssignmentRequest
    participant Service as NatureCheckCaseService
    participant FarmRepo as IFarmRepository
    participant PersonRepo as IPersonRepository
    participant CaseRepo as INatureCheckCaseRepository
    participant RoleRepo as IRoleRepository
    participant MsgService as IAppMessageService
    participant StatusService as IStatusInfoServices

    ArlaEmployee ->>+ ViewModel: AssignNatureCheckCaseAsync()
    
    alt Validation fails
        ViewModel ->>+ MsgService: AddErrorMessage("Vælg gård og konsulent")
        MsgService -->>- ViewModel: void
        ViewModel -->> ArlaEmployee: void
    else Validation succeeds
        ViewModel ->>+ StatusService: BeginLoading()
        StatusService -->>- ViewModel: IDisposable
        ViewModel ->> Request: new(farmId, consultantId, assignedByPersonId, notes, priority)
        Request --> ViewModel: NatureCheckCaseAssignmentRequest
        ViewModel ->>+ Service: AssignCaseAsync(request)
        
        Service ->>+ FarmRepo: GetByIdAsync(request.FarmId)
        FarmRepo -->>- Service: Farm?
        Service ->>+ PersonRepo: GetByIdAsync(request.ConsultantId)
        PersonRepo -->>- Service: Person?
        Service ->>+ RoleRepo: GetByIdAsync(consultant.RoleId)
        RoleRepo -->>- Service: Role?
        Service ->>+ CaseRepo: FarmHasActiveCaseAsync(farmId)
        CaseRepo -->>- Service: bool
        
        alt Validation error
            Service -->> ViewModel: Exception
            ViewModel ->>+ MsgService: AddErrorMessage(...)
            MsgService -->>- ViewModel: void
            ViewModel ->> StatusService: Dispose()
            ViewModel -->> ArlaEmployee: void
        else Validation succeeds
            Service ->>+ Service: CreateNatureCheckCaseEntity()
            Service -->>- Service: NatureCheckCase
            Service ->>+ CaseRepo: AddAsync(natureCheckCase)
            CaseRepo -->>- Service: NatureCheckCase
            
            Service -->> ViewModel: NatureCheckCase
            ViewModel ->>+ MsgService: AddInfoMessage("Natur Check opgave er oprettet")
            MsgService -->>- ViewModel: void
            ViewModel ->>+ ViewModel: RefreshFarmList()
            ViewModel -->>- ViewModel: void
            ViewModel ->> StatusService: Dispose()
            ViewModel -->> ArlaEmployee: void
        end
    end
    
    deactivate ViewModel
```

**Notes:**
- All method calls use PascalCase (C# convention).
- All calls have return arrows (including void methods).
- Exception handling follows UML conventions with alt fragments for alternatives.
- Activation bars show object lifetime using automatic activation/deactivation (+/-).
- Maximum 3 levels of nested fragments for readability.
