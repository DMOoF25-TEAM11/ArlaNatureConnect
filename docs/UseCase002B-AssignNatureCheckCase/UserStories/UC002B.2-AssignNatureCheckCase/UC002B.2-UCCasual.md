# Casual Use Case – UC002B.2: Assign Nature Check Case to Consultant

**Use case:** UC002B.2 – Assign Nature Check Case to Consultant  
**Scope:** The prototype of the Arla Nature Connect system  
**Level:** User goal  
**Primary Actors:** Arla Employee (Admin / Sustainability Staff)  
**Secondary Actors:** Consultant (receives the case via notification)

---

### **Stakeholders and Interests**

- **Arla employees** want to assign farms to consultants so Nature Checks can be planned and executed.  
- **Consultants** want to receive clear assignments they can act on, with priority levels and notes.

---

### **Preconditions**

- The Arla employee is authenticated (UC01).  
- The employee has viewed farms and consultants (UC002B.1).  
- The selected farm exists in the system.  
- The selected person exists in the system and has the *Consultant* role.  
- No active NatureCheckCase is currently assigned to the same farm.

---

### **Postconditions**

- A new **NatureCheckCase** is created with status **Assigned**.  
- The selected consultant is linked to the case.  
- Priority level (if selected) is stored in the database (English format: "Low", "Medium", "High", "Urgent").  
- A database notification is created for the consultant (consultant sees notification badge in UI).  
- The farm's assignment status is updated to "Tilføjet".  
- The consultant can now continue in **UC03 – Create Nature Check**.

---

### **Main Success Scenario**

1. The Arla employee has viewed the list of farms and consultants (from UC002B.1).  
2. The employee selects a farm that does not have an active case.  
3. The system presents the selected farm's summary information.  
4. The system displays button text "Lav natur Check opgave" (Create Nature Check task).  
5. The employee selects a consultant from the consultant list.  
6. The employee optionally selects a priority level (Lav, Normal, Høj, Haster).  
7. The employee optionally enters notes about the assignment.  
8. The employee confirms the assignment by clicking "Lav natur Check opgave".  
9. The system validates the farm, consultant role, priority format, and any business rules.  
10. The system creates a new Nature Check Case with:
    - Status set to "Assigned"
    - Linked to the selected farm
    - Assigned to the selected consultant
    - Marked as assigned by the authenticated Arla employee
    - Priority stored in English format (if provided)
    - Notes stored (if provided)
    - Creation time recorded
    - Assignment time recorded
11. The system creates a database notification for the consultant.  
12. The system updates the farm list to show "Tilføjet" status.  
13. The system shows success message "Natur Check opgave er oprettet for [FarmName]."  
14. The consultant can continue in **UC03 – Create Nature Check** to plan the visit.

---

### **Extensions (Alternatives)**

- **2a. Farm does not exist:**  
  The system displays an error and directs the employee to create the farm first (UC002B.4).

- **5a. No consultant selected:**  
  The system prompts the employee to choose a consultant before continuing.

- **5b. Selected user is not a consultant:**  
  The system rejects the selection and asks for a valid consultant.

- **5c. Consultant does not exist or is inactive:**  
  The system prevents assignment and requests another consultant.

- **6a. No priority selected:**  
  Priority is optional - the system allows assignment without priority.

- **6b. Priority value is invalid:**  
  The system validates priority format (must be "Low", "Medium", "High", or "Urgent" in English) and rejects invalid values.

- **9a. Farm already has an active case:**  
  The system displays error: "Gården har allerede en aktiv Natur Check opgave."  
  The employee can either:
  - Cancel the operation, or
  - Select a different farm, or
  - Update the existing case (UC002B.3)

- **11a. Notification creation fails:**  
  The case is still created, but the consultant may not see the notification immediately. The system logs the error for investigation.

---

### **Special Requirements**

- Priority values are displayed in Danish ("Lav", "Normal", "Høj", "Haster") in the UI but stored in English ("Low", "Medium", "High", "Urgent") in the database.
- Notifications are database-based (consultant sees notification badge in UI), not email/SMS.
- The system validates that the selected person has the Consultant role before creating the case.
- The system checks for active cases before creating a new one to prevent duplicates.
- All database operations use stored procedures (not Entity Framework).


