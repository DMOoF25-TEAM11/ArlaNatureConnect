# Brief Use Case – UC002B.4: Create Farm (Inline)

**Use Case ID:** UC002B.4  
**Use Case Name:** Create Farm (Inline)  
**Scope:** System prototype (Arla Nature Connect)  
**Level:** Subfunction  
**Primary Actor:** Arla Employee (Admin / Sustainability Staff)

---

## Brief Description

The Arla employee creates a new farm inline during the assignment process. The system validates CVR uniqueness and can reuse existing farmers (persons with Farmer role) if the owner email already exists.

---

## Preconditions

1. The Arla employee is authenticated in the system (UC01).
2. The employee is in the assignment process (UC002B.1 or UC002B.2).
3. All required farm information is provided (farm name, CVR number).
4. All required address information is provided (street, city, postal code, country).
5. All required owner information is provided (first name, last name, email).

---

## Postconditions

1. If creating a new farm:
   - A new farm is created in the system with the provided information
   - A new address is created and linked to the farm
   - If owner email does not exist: A new person (owner) is created with the Farmer role and linked to the farm
   - If owner email exists and person has Farmer role: The existing person is reused and linked to the new farm
   - The farm is available for selection in the assignment process
2. The farm appears in the farm list with the new information.

---

## Main Success Scenario

1. The employee clicks "Tilføj ny gård" (Add new farm) during assignment.
2. The system displays the farm creation form.
3. The employee enters farm details (name, CVR, address, owner information).
4. The employee submits the form.
5. The system validates CVR uniqueness.
6. The system checks if owner email exists.
7. If owner email exists and person has Farmer role: System reuses existing person.
8. If owner email does not exist: System creates new person with Farmer role.
9. The system creates the address.
10. The system creates the farm.
11. The system returns to the assignment form with the new farm available for selection.

---

## Extensions

### 5a. CVR already exists:
The system displays error: "En gård med CVR-nummer '[CVR]' findes allerede i systemet. Vælg et andet CVR-nummer." → Employee must change CVR.

### 7a. Owner email exists but person does not have Farmer role:
The system displays error: "En person med e-mail '[Email]' findes allerede i systemet, men har ikke rollen 'Farmer'." → Employee must use different email or contact administrator.

---

## Technology Notes

- The system uses stored procedures for all database operations (not Entity Framework).
- CVR uniqueness is validated at the database level.
- Farmer role validation is enforced to allow multiple farms per farmer.


