## UC002B.1 – Design Class Diagram

This diagram shows the main components that collaborate when an Arla employee views farms and consultants for assignment. It follows Larmann's UML conventions with proper visibility notation, relationships, and namespace organization.

```mermaid
classDiagram
    direction TB
    %% === DCD – UC002B.1: View Farms and Consultants ===

    %% === DOMAIN ENTITIES ===
    namespace ArlaNatureConnect.Domain.Entities {
        class Farm {
            +Guid Id
            +string Name
            +string CVR
            +Guid OwnerId
            +Guid AddressId
            +Person Owner
            +Address Address
        }

        class Person {
            +Guid Id
            +Guid RoleId
            +Guid AddressId
            +string FirstName
            +string LastName
            +string Email
            +bool IsActive
            +Role Role
            +Address Address
        }

        class Address {
            +Guid Id
            +string Street
            +string City
            +string PostalCode
            +string Country
        }

        class Role {
            +Guid Id
            +string Name
        }

        class NatureCheckCase {
            +Guid Id
            +Guid FarmId
            +Guid ConsultantId
            +Guid AssignedByPersonId
            +NatureCheckCaseStatus Status
            +string? Notes
            +string? Priority
            +DateTimeOffset CreatedAt
            +DateTimeOffset? AssignedAt
            +Farm Farm
            +Person Consultant
        }
    }

    %% === DTOs (Data Transfer Objects) ===
    namespace ArlaNatureConnect.Core.DTOs {
        class FarmAssignmentOverviewDto {
            +Guid FarmId
            +string FarmName
            +string Cvr
            +string OwnerFirstName
            +string OwnerLastName
            +string OwnerEmail
            +string Street
            +string City
            +string PostalCode
            +string Country
            +bool HasActiveCase
            +string? AssignedConsultantFirstName
            +string? AssignedConsultantLastName
            +Guid? AssignedConsultantId
            +string? Priority
            +string OwnerName
            +string AddressLine
            +string StatusLabel
            +string AssignedConsultantName
        }

        class NatureCheckCaseAssignmentContext {
            +IReadOnlyList~FarmAssignmentOverviewDto~ Farms
            +IReadOnlyList~Person~ Consultants
        }
    }

    %% === VIEWMODELS (Application Layer) ===
    namespace ArlaNatureConnect.WinUI.ViewModels.Pages {
        class ArlaEmployeeAssignNatureCheckViewModel {
            -INatureCheckCaseService _natureCheckCaseService
            -IStatusInfoServices _statusInfoServices
            -List~AssignableFarmViewModel~ _allFarms
            -ObservableCollection~Person~ _consultants
            +ObservableCollection~AssignableFarmViewModel~ FilteredFarms
            +ObservableCollection~Person~ Consultants
            +Task InitializeAsync()
            -Task EnsureAssignmentDataAsync()
            -void UpdateFarms(IReadOnlyList~FarmAssignmentOverviewDto~)
            -void UpdateConsultants(IEnumerable~Person~)
        }
    }

    namespace ArlaNatureConnect.WinUI.ViewModels.Items {
        class AssignableFarmViewModel {
            +Guid FarmId
            +string FarmName
            +string Cvr
            +string OwnerFirstName
            +string OwnerLastName
            +string OwnerName
            +string AddressLine
            +bool HasActiveCase
            +string StatusLabel
            +string? Priority
            +string? PriorityDisplay
            +Guid? AssignedConsultantId
            +string ConsultantDisplay
            +void Apply(FarmAssignmentOverviewDto)
        }
    }

    namespace ArlaNatureConnect.WinUI.ViewModels.Abstracts {
        class ViewModelBase {
            <<abstract>>
            +event PropertyChangedEventHandler? PropertyChanged
            +void OnPropertyChanged(string?)
        }
    }

    %% === SERVICES (Core Layer) ===
    namespace ArlaNatureConnect.Core.Services {
        class INatureCheckCaseService {
            <<interface>>
            +Task~NatureCheckCaseAssignmentContext~ LoadAssignmentContextAsync(CancellationToken) Task
        }

        class NatureCheckCaseService {
            -IFarmRepository _farmRepository
            -IPersonRepository _personRepository
            -IAddressRepository _addressRepository
            -INatureCheckCaseRepository _natureCheckCaseRepository
            +Task~NatureCheckCaseAssignmentContext~ LoadAssignmentContextAsync(CancellationToken) Task
            -FarmAssignmentOverviewDto CreateFarmOverview(Farm, IDictionary~Guid,Person~, IDictionary~Guid,Address~, bool, IDictionary~Guid,NatureCheckCase~) FarmAssignmentOverviewDto
        }

        class IStatusInfoServices {
            <<interface>>
            +IDisposable BeginLoading()
        }
    }

    %% === REPOSITORIES (Core Abstract Layer) ===
    namespace ArlaNatureConnect.Core.Abstract {
        class IRepository~TEntity~ {
            <<interface>>
            +Task~IEnumerable~TEntity~~ GetAllAsync(CancellationToken) Task
        }

        class INatureCheckCaseRepository {
            <<interface>>
            +Task~IReadOnlyList~NatureCheckCase~~ GetActiveCasesAsync(CancellationToken) Task
        }

        class IFarmRepository {
            <<interface>>
        }

        class IPersonRepository {
            <<interface>>
            +Task~IEnumerable~Person~~ GetPersonsByRoleAsync(string, CancellationToken) Task
        }

        class IAddressRepository {
            <<interface>>
        }
    }

    %% === RELATIONER (Relationships) ===
    %% Inheritance
    ArlaEmployeeAssignNatureCheckViewModel --|> ViewModelBase
    AssignableFarmViewModel --|> ViewModelBase

    %% Interface Implementation
    NatureCheckCaseService ..|> INatureCheckCaseService : implements
    INatureCheckCaseRepository --|> IRepository : extends
    IFarmRepository --|> IRepository : extends
    IPersonRepository --|> IRepository : extends
    IAddressRepository --|> IRepository : extends

    %% Dependencies (uses)
    ArlaEmployeeAssignNatureCheckViewModel --> INatureCheckCaseService : uses
    ArlaEmployeeAssignNatureCheckViewModel --> IStatusInfoServices : uses

    NatureCheckCaseService --> INatureCheckCaseRepository : uses
    NatureCheckCaseService --> IFarmRepository : uses
    NatureCheckCaseService --> IPersonRepository : uses
    NatureCheckCaseService --> IAddressRepository : uses

    %% Repository manages Entities
    INatureCheckCaseRepository --> NatureCheckCase : manages
    IFarmRepository --> Farm : manages
    IPersonRepository --> Person : manages
    IAddressRepository --> Address : manages

    %% ViewModel uses DTOs
    ArlaEmployeeAssignNatureCheckViewModel --> NatureCheckCaseAssignmentContext : uses
    AssignableFarmViewModel --> FarmAssignmentOverviewDto : uses

    %% Service uses DTOs
    NatureCheckCaseService --> FarmAssignmentOverviewDto : creates
    NatureCheckCaseService --> NatureCheckCaseAssignmentContext : creates

    %% Domain Entity Relationships (Navigation Properties)
    NatureCheckCase --> Farm : Farm
    NatureCheckCase --> Person : Consultant
    Farm --> Person : Owner
    Farm --> Address : Address
    Person --> Role : Role
    Person --> Address : Address
```


