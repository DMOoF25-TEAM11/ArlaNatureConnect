## UC002B.1 – Sequence Diagram: View Farms and Consultants for Assignment

This sequence diagram shows the detailed interaction flow when an Arla employee views farms and consultants, following Larmann's UML conventions.

```mermaid
sequenceDiagram
    title UC002B.1 – Sequence Diagram: View Farms and Consultants for Assignment

    actor ArlaEmployee as Arla Employee
    participant ViewModel as ArlaEmployeeAssignNatureCheckViewModel
    participant Service as NatureCheckCaseService
    participant FarmRepo as IFarmRepository
    participant PersonRepo as IPersonRepository
    participant AddressRepo as IAddressRepository
    participant CaseRepo as INatureCheckCaseRepository
    participant StatusService as IStatusInfoServices

    %% Initialization Flow
    ArlaEmployee ->> ViewModel: Open "Nature Check Cases" module
    ViewModel ->> StatusService: BeginLoading()
    StatusService -->> ViewModel: IDisposable loading
    ViewModel ->> Service: LoadAssignmentContextAsync()
    
    %% Service loads data from multiple repositories
    Service ->> FarmRepo: GetAllAsync()
    FarmRepo -->> Service: List~Farm~
    Service ->> PersonRepo: GetAllAsync()
    PersonRepo -->> Service: List~Person~
    Service ->> PersonRepo: GetPersonsByRoleAsync("Consultant")
    PersonRepo -->> Service: List~Person~ (Consultants)
    Service ->> AddressRepo: GetAllAsync()
    AddressRepo -->> Service: List~Address~
    Service ->> CaseRepo: GetActiveCasesAsync()
    CaseRepo -->> Service: IReadOnlyList~NatureCheckCase~
    
    %% Service maps Entities to DTOs
    Note over Service: Maps Farm + Person + Address + Case → FarmAssignmentOverviewDto<br/>Determines assignment status for each farm
    Service -->> ViewModel: NatureCheckCaseAssignmentContext<br/>(Farms: List~FarmAssignmentOverviewDto~,<br/>Consultants: List~Person~)
    
    %% ViewModel maps DTOs to ViewModel Items
    Note over ViewModel: Maps FarmAssignmentOverviewDto → AssignableFarmViewModel<br/>Sorts farms and consultants alphabetically
    ViewModel ->> ViewModel: UpdateFarms(context.Farms)
    ViewModel ->> ViewModel: UpdateConsultants(context.Consultants)
    ViewModel ->> StatusService: Dispose loading
    ViewModel -->> ArlaEmployee: Display farms and consultants
```

**Notes:**
- The service aggregates data from multiple repositories to create a comprehensive view.
- Assignment status is calculated by checking for active cases (status "Assigned" or "InProgress").
- Farms and consultants are sorted alphabetically in the ViewModel.
- This is a read-only operation - no data is modified.


